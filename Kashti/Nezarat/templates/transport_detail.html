{% extends 'base.html' %}
{% block content %}
<div class="container my-5">
    <h2 class="text-center mb-4">ğŸšš Ø¬Ø²Ø¦ÛŒØ§Øª Ø¹Ù…Ù„ÛŒØ§Øª Ø­Ù…Ù„â€ŒÙˆÙ†Ù‚Ù„</h2>

    <div class="card mb-4">
        <div class="card-body">
            <p><strong>Ú©Ø´ØªÛŒ:</strong> {{ operation.ship.name }}</p>
            <p><strong>Ù…Ø¨Ø¯Ø§:</strong> {{ operation.from_warehouse.name }}</p>
            <p><strong>Ù…Ù‚ØµØ¯:</strong> {{ operation.to_warehouse.name }}</p>
            <p><strong>Ù…Ø³Ø§ÙØª:</strong> {{ operation.distance_km }} Ú©ÛŒÙ„ÙˆÙ…ØªØ±</p>
            <p><strong>Ù…Ø¯Øª Ø³ÙØ±:</strong> {{ operation.estimated_duration_hr }} Ø³Ø§Ø¹Øª</p>
            <p><strong>ÙˆØ¶Ø¹ÛŒØª:</strong> {{ operation.get_status_display }}</p>
        </div>
    </div>

    {% if expired_items %}
        <div class="alert alert-danger text-center">
            âš ï¸ Ø¨Ø±Ø®ÛŒ Ø§Ø² Ù‚Ø·Ø¹Ø§Øª Ø¯Ø± Ø·ÙˆÙ„ Ø³ÙØ± Ù…Ù†Ù‚Ø¶ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯!
        </div>
    {% endif %}

    <div class="card">
        <div class="card-header bg-secondary text-white">Ù„ÛŒØ³Øª Ù‚Ø·Ø¹Ø§Øª</div>
        <div class="card-body">
            <table class="table table-hover text-center">
                <thead>
                    <tr>
                        <th>Ù†Ø§Ù… Ù‚Ø·Ø¹Ù‡</th>
                        <th>ØªØ¹Ø¯Ø§Ø¯</th>
                        <th>Ù…ØµØ±ÙÛŒØŸ</th>
                        <th>Ø¯Ø±ØµØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡</th>
                        <th>Ø§Ù†Ø¨Ø§Ø± Ù…Ø¨Ø¯Ø§</th>
                        <th>Ø²ÛŒØ±Ø§Ù†Ø¨Ø§Ø± Ù…Ù‚ØµØ¯</th>
                        <th>Ù…Ù†Ù‚Ø¶ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                        <tr>
                            <td>{{ item.part.name }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.is_consumable|yesno:"âœ…,âŒ" }}</td>
                            <td>{{ item.usage_percent }}%</td>
                            <td>{{ item.from_warehouse.name }}</td>
                            <td>{{ item.to_subwarehouse.name }}</td>
                            <td>
                                {% if item.will_expire_during %}âš ï¸ Ø¨Ù„Ù‡{% else %}ğŸŸ¢ Ø®ÛŒØ±{% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<div id="map" style="height: 400px;" class="my-4"></div>
<table class="table table-striped text-center">
    <thead>
        <tr>
            <th>Ù‚Ø·Ø¹Ù‡</th>
            <th>ØªØ¹Ø¯Ø§Ø¯</th>
            <th>Ø²ÛŒØ±Ø§Ù†Ø¨Ø§Ø± Ú©Ø´ØªÛŒ</th>
            <th>Ø¯Ø± Ø³ÙØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ</th>
            <th>ÙˆØ¶Ø¹ÛŒØª</th>
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
            <tr>
                <td>{{ item.part.name }}</td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.ship_subwarehouse.name if item.ship_subwarehouse }}</td>
                <td>{% if item.used_in_trip %} âœ… Ø¨Ù„Ù‡ {% else %} âŒ ÙÙ‚Ø· Ø¬Ø§Ø¨Ù‡â€ŒØ¬Ø§ÛŒÛŒ {% endif %}</td>
                <td>
                    {% if item.is_worn_out %}
                        ğŸ”´ ÙØ±Ø³ÙˆØ¯Ù‡ Ø´Ø¯Ù‡
                    {% else %}
                        ğŸŸ¢ Ø³Ø§Ù„Ù…
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<script>
function initMap() {
    const from = { lat: {{ operation.from_warehouse.latitude }}, lng: {{ operation.from_warehouse.longitude }} };
    const to = { lat: {{ operation.to_warehouse.latitude }}, lng: {{ operation.to_warehouse.longitude }} };

    const map = new google.maps.Map(document.getElementById("map"), {
        center: from,
        zoom: 6,
    });

    new google.maps.Marker({ position: from, map, title: "Ø§Ù†Ø¨Ø§Ø± Ù…Ø¨Ø¯Ø§" });
    new google.maps.Marker({ position: to, map, title: "Ø§Ù†Ø¨Ø§Ø± Ù…Ù‚ØµØ¯" });

    const route = new google.maps.Polyline({
        path: [from, to],
        geodesic: true,
        strokeColor: "#007bff",
        strokeOpacity: 1.0,
        strokeWeight: 3,
    });

    route.setMap(map);
}
</script>
<script async
    src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap">
</script>

<div class="alert alert-info text-center">
    <form method="post">
        {% csrf_token %}
        <h5>Ø¢ÛŒØ§ Ø§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª Ø±Ø§ ØªØ£ÛŒÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ØŸ</h5>
        <button class="btn btn-success">ØªØ£ÛŒÛŒØ¯ Ø¹Ù…Ù„ÛŒØ§Øª</button>
    </form>
</div>


{% endblock %}
